<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Escena A-Frame Realista</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.0/dist/aframe-extras.controls.min.js"></script>
  </head>
  <body>
    <a-scene shadow="type: pcfsoft" 
             renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true; toneMapping: ACESFilmic; exposure: 1.0">
      
      <!-- Assets: modelos GLB separados -->
      <a-assets>
        <a-asset-item id="pisoModel" src="models/piso.glb"></a-asset-item>
        <a-asset-item id="paredesModel" src="models/paredes.glb"></a-asset-item>
        <a-asset-item id="techoModel" src="models/techo.glb"></a-asset-item>
        <!-- Otros modelos de assets aquí -->
        <a-asset-item id="cuarto1" src="models/assets1.glb"></a-asset-item>
        <a-asset-item id="cuarto2" src="models/assets2.glb"></a-asset-item>
        <a-asset-item id="cuarto3" src="models/assets3.glb"></a-asset-item>
        <a-asset-item id="cuarto4" src="models/assets4.glb"></a-asset-item>
        <a-asset-item id="cuarto5" src="models/assets5.glb"></a-asset-item>
        <a-asset-item id="cuarto6" src="models/assets6.glb"></a-asset-item>
        <a-asset-item id="cuarto7" src="models/assets7.glb"></a-asset-item>
      </a-assets>

      <!-- Luces: ambiental + direccional -->
      <a-entity id="greenLamp"
          position="-1.5 1.5 -0.75"
          light="type: point; 
                 color: #2bff7a; 
                 intensity: 5; 
                 distance: 30; 
                 decay: 2; 
                 castShadow: true; 
                 shadowMapWidth: 2500; 
                 shadowMapHeight: 2500; 
                 shadowBias: -0.0003">
</a-entity>

      <!-- Modelos GLB cargados -->
      <a-entity gltf-model="#pisoModel" shadow="receive: true"></a-entity>
      <a-entity gltf-model="#paredesModel" shadow="cast: true; receive: true"></a-entity>
      <a-entity gltf-model="#techoModel" shadow="cast: true"></a-entity>
      <!-- otros modelos y entidades aquí -->
      <a-entity id="cuarto1_ent" gltf-model="#cuarto1" shadow="cast: true; receive: true"></a-entity>
      <a-entity id="cuarto2_ent" gltf-model="#cuarto2" shadow="cast: true; receive: true"></a-entity>
      <a-entity id="cuarto3_ent" gltf-model="#cuarto3" shadow="cast: true; receive: true"></a-entity>
      <a-entity id="cuarto4_ent" gltf-model="#cuarto4" shadow="cast: true; receive: true"></a-entity>
      <a-entity id="cuarto5_ent" gltf-model="#cuarto5" shadow="cast: true; receive: true"></a-entity>
      <a-entity id="cuarto6_ent" gltf-model="#cuarto6" shadow="cast: true; receive: true"></a-entity>
      <a-entity id="cuarto7_ent" gltf-model="#cuarto7" shadow="cast: true; receive: true"></a-entity>

      <!-- Cámara y controles -->
      <a-entity id="cameraRig" movement-controls="fly: false; speed: 0.1">
      <a-entity 
      camera 
      position="0 1.5 0" 
      look-controls="pointerLockEnabled: true; touchEnabled: true">
      </a-entity>
      </a-entity>

    <script>
      // Ajustar materia invisibilidad de plano de sombra al cargar la escena
      document.querySelector('a-scene').addEventListener('loaded', () => {
        const plane = document.querySelector('#shadowPlane');
        const mesh = plane.getObject3D('mesh');
        if (mesh) {
          mesh.material = new THREE.ShadowMaterial({ opacity: 0.5 });
          mesh.material.side = THREE.DoubleSide;
        }
        // Centrado automático: calcular bounding box de los modelos
        const bbox = new THREE.Box3();
        document.querySelectorAll('a-entity[gltf-model]').forEach(ent => {
          const obj = ent.getObject3D('mesh');
          if (obj) bbox.expandByObject(obj);
        });
        const center = bbox.getCenter(new THREE.Vector3());
        const rig = document.querySelector('#cameraRig');
        rig.object3D.position.set(center.x, center.y, center.z);
      });
    </script>
  </body>
</html>
